version: '3.4'
services:
  django:
    depends_on:
     - redis
     - postgres
      # redis:
      #   condition: service_healthy
      # postgres:
      #   condition: service_healthy
    build:
      context: ../..
      dockerfile: ./.ci/Dockerfile.alpine
      # target: test
    env_file:
      - ../../.env.example
    ports:
      - "8000:8000"

  postgres:
    image: postgres:15-alpine
    expose:
      - "5432:5432"
    env_file:
      - ../../.env.example
    # healthcheck:
    #   test: ["CMD-SHELL", "pg_isready -U postgres"]
    #   interval: 1s
    #   timeout: 3s
    #   retries: 5

  redis:
    image: redis:7-alpine
    # healthcheck:
    #   test: [ "CMD", "redis-cli", "--raw", "incr", "ping" ]
    #   interval: 1s
    #   timeout: 3s
    #   retries: 5
    expose:
      - "6379:6379"